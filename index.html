<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
<select name="value">
  <option class="group">
    Кировский форк
  </option>
  <option value="https://prochepetsk.ru">pgch.frontend (master)</option>
  <option value="https://progoroduhta.ru">pguhta.frontend (master)</option>
  <option value="https://ngnovoros.ru">pg23.frontend (master)</option>
  <option value="https://progorod33.ru">pg33.frontend (master)</option>
  <option value="https://progorod43.ru">pg43.frontend (master)</option>
  <option value="https://progorod58.ru">pg58.frontend (master)</option>
  <option value="https://lipetsknews.ru">lipetsknews.frontend (master)</option>
  <option value="https://usolie.info">usolie.frontend (master)</option>
  <option value="https://media41.ru">media41.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://youtvnews.com">youtvnews.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://progorod35.ru">pg35.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://irbit.city">irbit.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://irkutsk.news">irkutsk.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://bryansk.news">bryansk.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://kaliningradtv.ru">kaliningradtv.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://materinstvo.ru">materinstvo.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://volgogradru.com">volgogradru.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://women365.ru">women365.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://oren1.ru">pg56.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://progorod62.ru">pg62.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://progorodche.ru">pg74.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://pg69.ru">pg69.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option class="group">
    Чебоксарский форк
  </option>
  <option value="https://pg02.ru">pg02.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://pg12.ru">pg12.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://pg21.ru">pg21.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://progorodnn.ru">pgnn.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://prosaratov.ru">pg64.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://prodzer.ru">pgdzer.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://pg37.ru">pg37.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://pg46.ru">pg46.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://pgr76.ru">pg176.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://pgn21.ru">pg121.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option class="group">
    jenkins2
  </option>
  <option value="https://чаллы.рф">chally.frontend (master)</option>
  <option value="https://ko44.ru">ko44.frontend (master)</option>
  <option value="https://vrntimes.ru">vrntimes.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://newtambov.ru">newtambov.frontend (b.provotorov-22715_npm_update)</option>
  <option value="https://smilekaluga.ru">smilekaluga.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://24nf.ru">24nf.frontend (b.provotorov-23078_banners_fixed_height)</option>
  <option value="https://gorodglazov.com">gorodglazov.frontend (b.provotorov-23078_banners_fixed_height_next15)</option>
  <option value="https://myliski.ru">myliski.frontend (b.provotorov-23078_banners_fixed_height_next15)</option>
  <option value="https://pg11.ru">pg11.frontend (b.provotorov-23078_banners_fixed_height_next15)</option>
  <option value="https://pg13.ru">pg13.frontend (b.provotorov-23078_banners_fixed_height_next15)</option>
  <option value="https://gazeta45.com">gazeta45.frontend (b.provotorov-23078_banners_fixed_height_next15)</option>
  <option value="https://vladivostoktimes.ru">vladivostoktimes.frontend (b.provotorov-23078_banners_fixed_height_next15)</option>
  <option value="https://newskrasnodar.ru">newskrasnodar.frontend (b.provotorov-23078_banners_fixed_height_next15)</option>
  <option value="https://inforostov.ru">inforostov.frontend (b.provotorov-23078_banners_fixed_height_next15)</option>
  <option value="https://progorod76.ru">pg76.frontend (b.provotorov-23078_banners_fixed_height_next15)</option>
</select>

<div id="selectboxValues"></div>
<script>
  const selectbox = document.querySelector('select');
  selectbox.style = 'display: none;';
  const selectboxValues = document.querySelector('#selectboxValues');

  // Генерируем HTML из опций select
  for (let i = 0; i < selectbox.children.length; i += 1) {
    const isGroupClass = selectbox.children[i].classList.contains('group');
    let innerHTML = selectbox[i].innerHTML;

    // Ищем шаблон (название_ветки) и добавляем кнопку копирования
    const branchRegex = /\(([^)]+)\)/;
    const match = innerHTML.match(branchRegex);
    if (match) {
      const branchName = match[1];
      innerHTML = innerHTML.replace(
        branchRegex,
        `(${branchName} <button class="copy-btn" data-branch="${branchName}" title="Скопировать название ветки"></button>)`
      );
    }

    selectboxValues.innerHTML += `<p class="${isGroupClass ? 'group' : 'group-item'}" data-index="${i}">
      ${innerHTML}${!isGroupClass ? `— <a href="${selectbox[i].value}" target="_blank">${selectbox[i].value}</a>` : ''}
    </p>`;
  }

  // Функция копирования в буфер обмена
  async function copyToClipboard(text) {
    try {
      // Современный API (требуется HTTPS и активное взаимодействие пользователя)
      if (navigator.clipboard && window.isSecureContext) {
        await navigator.clipboard.writeText(text);
        return true;
      }
      
      // Fallback для старых браузеров
      const textarea = document.createElement('textarea');
      textarea.value = text;
      textarea.style.position = 'fixed';
      textarea.style.opacity = 0;
      textarea.style.left = '-9999px';
      document.body.appendChild(textarea);
      textarea.focus();
      textarea.select();
      
      const success = document.execCommand('copy');
      document.body.removeChild(textarea);
      return success;
    } catch (err) {
      console.error('Ошибка при копировании:', err);
      return false;
    }
  }

  // Обработчик клика по кнопке копирования
  document.querySelectorAll('.copy-btn').forEach(btn => {
    btn.addEventListener('click', async (e) => {
      const branchName = e.target.getAttribute('data-branch');
      const success = await copyToClipboard(branchName);
      
      if (success) {
        // Визуальная обратная связь: меняем иконку на галочку
        e.target.setAttribute('data-copied', 'true');
        setTimeout(() => {
          e.target.removeAttribute('data-copied');
        }, 2000);
      } else {
        alert('Не удалось скопировать. Попробуйте вручную.');
      }
    });
  });

  // Добавляем блок статистики
  const statistics = document.createElement('div');
  statistics.setAttribute('class', 'statistics');
  statistics.innerHTML = `
    Выполнено: <span class="deploy-is-done">0</span><br>
    Осталось выполнить: <span class="deploy-no-done">${document.querySelectorAll('.group-item').length}</span><br>
    Время выполнения: <span class="time">0:00:00</span><br><br>
    <button class="clear-button" type="button">Сбросить</button>
  `;
  selectboxValues.before(statistics);

  // Функция перевода секунд в формат ЧЧ:ММ:СС
  const secondsToHms = (d) => {
    d = Number(d);
    const h = Math.floor(d / 3600);
    const m = Math.floor((d % 3600) / 60);
    const s = Math.floor(d % 60);

    const hDisplay = h > 0 ? `${h}:` : '0:';
    const mDisplay = m < 10 ? `0${m}:` : `${m}:`;
    const sDisplay = s < 10 ? `0${s}` : `${s}`;


    return hDisplay + mDisplay + sDisplay;
  };

  // Инициализация таймера с сохранением в localStorage
  let timerInterval;
  const handleStartTimer = () => {
    const timeElement = document.querySelector('.time');
    let timeStart = parseInt(localStorage.getItem('timerSeconds')) || 0;

    timerInterval = setInterval(() => {
      timeStart += 1;
      localStorage.setItem('timerSeconds', timeStart);
      timeElement.innerHTML = secondsToHms(timeStart);
    }, 1000);
  };

  // Восстановление состояния элементов из localStorage
  const restoreState = () => {
    const groupItems = document.querySelectorAll('.group-item');
    groupItems.forEach(item => {
      const index = item.getAttribute('data-index');
      const storedClass = localStorage.getItem(`item-${index}`);


      if (storedClass) {
        item.classList.add(storedClass);
      }
    });

    // Обновляем статистику после восстановления
    updateStatistics();
  };

  // Обновление статистики
  const updateStatistics = () => {
    const totalDeploys = document.querySelectorAll('.group-item').length;
    const totalDeploysDone = document.querySelectorAll('.group-item.green').length;

    document.querySelector('.deploy-no-done').textContent = totalDeploys - totalDeploysDone;
    document.querySelector('.deploy-is-done').textContent = totalDeploysDone;
  };

  // Обработчик клика по элементу
  const groupItems = document.querySelectorAll('.group-item');
  let startDeplay = 0;

  groupItems.forEach(item => {
    let countClick = 0;
    const index = item.getAttribute('data-index');

    item.addEventListener('click', (evt) => {
      if (evt.target.nodeName === 'A' || evt.target.classList.contains('copy-btn')) return;


      startDeplay += 1;
      if (startDeplay === 1 && !localStorage.getItem('timerSeconds')) {
        handleStartTimer();
      }

      countClick = countClick >= 2 ? 0 : countClick + 1;


      // Удаляем старые классы
      item.classList.remove('yellow', 'green');

      if (countClick === 1) {
        item.classList.add('yellow');
      } else if (countClick === 2) {
        item.classList.add('green');
      }

      // Сохраняем текущее состояние в localStorage
      localStorage.setItem(`item-${index}`, item.classList.contains('green') ? 'green' : item.classList.contains('yellow') ? 'yellow' : '');

      // Обновляем статистику
      updateStatistics();
    });
  });

  // Функция очистки localStorage и классов
  const clearStorageAndClasses = () => {
    // Останавливаем таймер, если он запущен
    if (timerInterval) {
      clearInterval(timerInterval);
      timerInterval = null;
    }

    // Очищаем localStorage
    localStorage.removeItem('timerSeconds');
    document.querySelectorAll('.group-item').forEach(item => {
      const index = item.getAttribute('data-index');
      localStorage.removeItem(`item-${index}`);
    });

    // Сбрасываем классы у всех элементов
    document.querySelectorAll('.group-item').forEach(item => {
      item.classList.remove('yellow', 'green');
    });

    // Обнуляем таймер в интерфейсе
    document.querySelector('.time').textContent = '0:00:00';

    // Обновляем статистику
    updateStatistics();
  };

  // Добавляем кнопку очистки
  const clearButton = document.querySelector('.clear-button');

  // Привязываем обработчик к кнопке
  clearButton.addEventListener('click', clearStorageAndClasses);

  // Восстанавливаем состояние при загрузке страницы
  window.addEventListener('load', () => {
    restoreState();

    // Если таймер был запущен, продолжаем его
    const storedSeconds = localStorage.getItem('timerSeconds');
    if (storedSeconds && storedSeconds > 0) {
      handleStartTimer();
    }
  });
</script>
  <style>
    .group {
      font-size: 18px;
      font-family: sans-serif;
      font-weight: bold;
    }

    .agreements__item {
      padding: 30px 0 30px 0;
      border-bottom: 1px solid;
      max-width: 800px;
    }

    .agreement__domain {
      margin-bottom: 10px;
    }
    
    p {
      margin: 0;
    }

    .group {
      margin-top: 16px;
      margin-bottom: 16px;
      max-width: 800px;
    }

    .group + .group-item {
      border-top: 1px solid #cccccc;
    }

    .group-item:hover {
      background-color: #e3e3e3;
    }

    .group-item:not(:last-child) {
      border-bottom: 1px solid #cccccc;
    }

    .group-item {
      padding: 10px;
      border-radius: 5px;
      margin: 10px 0;
      background-color: #e2e2e2;
      cursor: pointer;
      max-width: 800px;
      position: relative;
    }

    .group-item.active {
      background-color: #437a49;
      color: #fff;
      padding: 10px;
    }

    .group-item.active a {
      color: #fff;
    }

    .group-item.yellow {
      background-color: #e1e4a6;
    }

    .group-item.green {
      background-color: #237e50;
      color: #ffffff;
    }

    .group-item.green a {
      color: #ffffff;
    }

    .clear-button {
      background-color: #dc3545;
      color: white;
      border: none;
      padding: 8px 16px;
      font-size: 14px;
      font-family: sans-serif;
      cursor: pointer;
      border-radius: 5px;
      transition: all 0.3s ease;
      outline: none;
    }

    .clear-button:hover {
      background-color: #c82333;
      transform: translateY(-1px);
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    }

    .clear-button:active {
      background-color: #b21f30;
      transform: translateY(0);
      box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
    }

        /* Стили для кнопки копирования */
    .copy-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 4px;
      border: 1px solid #d3d3d3;
      background-color: #ffffff;
      padding: 8px 16px;
      text-decoration: none;
      cursor: pointer;
      transition: background-color 0.2s, transform 0.1s;
      position: absolute;
      right: 10px;
      top: 50%;
      transform: translateY(-50%);
    }

    .copy-btn:hover {
      background-color: rgb(225 225 225);
      transform: translateY(-50%) scale(1.05);
    }

    .copy-btn::before {
      content: 'Копировать имя ветки'; /* Символ "ножницы" */
      line-height: 1;
    }

    .copy-btn[data-copied="true"]::before {
      content: '✓';
      color: #28a745;
    }

    .copy-btn[data-copied="true"]:hover {
      background-color: #ffffff;
    }
  </style>
</body>
</html>